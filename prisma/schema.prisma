generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum role {
  ADMIN_STAN
  SISWA
}

enum jenis {
  MAKANAN
  MINUMAN
}

enum status {
  BELUM
  DIMASAK
  SELESAI
}

model users {
  id              Int       @id @default(autoincrement())
  username        String    @unique
  password        String    
  role            role

  siswa           siswa[]
  stan            stan[]

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model siswa {
  id              Int       @id @default(autoincrement())
  uuid            String    @unique
  nama            String
  alamat          String    @db.Text
  telepon         String
  foto            String    @db.Text

  user            users?    @relation(fields: [id_user], references: [id], onDelete: Cascade)
  id_user         Int

  transaksi       transaksi[]
}

model stan {
  id              Int       @id @default(autoincrement())
  nama_stan       String
  nama_pemilik    String
  telepon         String

  user            users?    @relation(fields: [id_user], references: [id], onDelete: Cascade)
  id_user         Int

  menu            menu[]
  transaksi       transaksi[]
  diskon          diskon[]
}

model menu {
  id                Int              @id @default(autoincrement())
  nama_menu         String
  harga             Decimal          @db.Decimal(10,2)
  jenis             jenis
  foto              String           @db.Text
  deskripsi         String           @db.Text

  stan              stan             @relation(fields: [id_stan], references: [id], onDelete: Cascade)
  id_stan           Int

  menu_diskon       menu_diskon[]
  detail_transaksi  detail_transaksi[]
}

model diskon {
  id              Int              @id @default(autoincrement())
  nama_diskon     String
  persentase      Float
  tanggal_awal    DateTime
  tanggal_akhir   DateTime

  stan            stan             @relation(fields: [id_stan], references: [id], onDelete: Cascade)
  id_stan         Int

  menu_diskon     menu_diskon[]
}

model menu_diskon {
  id              Int      @id @default(autoincrement())
  menu            menu     @relation(fields: [id_menu], references: [id], onDelete: Cascade)
  id_menu         Int

  diskon          diskon   @relation(fields: [id_diskon], references: [id], onDelete: Cascade)
  id_diskon       Int
}


model transaksi {
  id              Int       @id @default(autoincrement())
  uuid            String    @unique
  tanggal         DateTime  @default(now())
  status          status    @default(BELUM)

  stan            stan      @relation(fields: [id_stan], references: [id])
  id_stan         Int

  siswa           siswa     @relation(fields: [id_siswa], references: [id])
  id_siswa        Int

  detail_transaksi  detail_transaksi[]
}

model detail_transaksi {
  id              Int       @id @default(autoincrement())
  jumlah          Int
  catatan         String?   @default("-") @db.Text
  harga_total     Decimal   @db.Decimal(10,2)

  transaksi       transaksi @relation(fields: [id_transaksi], references: [id], onDelete: Cascade)
  id_transaksi    Int

  menu            menu      @relation(fields: [id_menu], references: [id])
  id_menu         Int
}