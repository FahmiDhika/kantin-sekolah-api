generator client {
  provider      = "prisma-client-js"
  output        = "../dist/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  siswa     siswa[]
  stan      stan[]
}

model siswa {
  id        Int         @id @default(autoincrement())
  uuid      String      @unique
  nama      String
  alamat    String
  telepon   String
  foto      String
  id_user   Int
  user      users       @relation(fields: [id_user], references: [id], onDelete: Cascade)
  transaksi transaksi[]
}

model stan {
  id           Int         @id @default(autoincrement())
  nama_stan    String
  nama_pemilik String
  telepon      String
  id_user      Int
  diskon       diskon[]
  menu         menu[]
  user         users       @relation(fields: [id_user], references: [id], onDelete: Cascade)
  transaksi    transaksi[]
}

model menu {
  id               Int                @id @default(autoincrement())
  nama_menu        String
  harga            Decimal            @db.Decimal(10, 2)
  jenis            jenis
  foto             String
  deskripsi        String
  id_stan          Int
  detail_transaksi detail_transaksi[]
  stan             stan               @relation(fields: [id_stan], references: [id], onDelete: Cascade)
  menu_diskon      menu_diskon[]
}

model diskon {
  id            Int           @id @default(autoincrement())
  nama_diskon   String
  persentase    Float
  tanggal_awal  DateTime
  tanggal_akhir DateTime
  id_stan       Int
  stan          stan          @relation(fields: [id_stan], references: [id], onDelete: Cascade)
  menu_diskon   menu_diskon[]
}

model menu_diskon {
  id        Int    @id @default(autoincrement())
  id_menu   Int
  id_diskon Int
  diskon    diskon @relation(fields: [id_diskon], references: [id], onDelete: Cascade)
  menu      menu   @relation(fields: [id_menu], references: [id], onDelete: Cascade)
}

model transaksi {
  id               Int                @id @default(autoincrement())
  tanggal          DateTime           @default(now())
  id_stan          Int
  id_siswa         Int
  uuid             String             @unique
  status           status             @default(BELUM)
  detail_transaksi detail_transaksi[]
  siswa            siswa              @relation(fields: [id_siswa], references: [id])
  stan             stan               @relation(fields: [id_stan], references: [id])
}

model detail_transaksi {
  id           Int       @id @default(autoincrement())
  jumlah       Int
  harga_total  Decimal   @db.Decimal(10, 2)
  id_transaksi Int
  id_menu      Int
  catatan      String?   @default("-")
  menu         menu      @relation(fields: [id_menu], references: [id])
  transaksi    transaksi @relation(fields: [id_transaksi], references: [id], onDelete: Cascade)
}

enum role {
  ADMIN_STAN
  SISWA
}

enum jenis {
  MAKANAN
  MINUMAN
}

enum status {
  BELUM
  DIMASAK
  SELESAI
}
